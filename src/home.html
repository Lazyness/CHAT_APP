<!DOCTYPE html>
<html lang="en">

<head>
    <title>Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Uchen&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300&display=swap" rel="stylesheet">
</head>

<body>
    <header class="header">
        <img class="logo" src="images/logo.png" alt="logo">
        <div class="div__edit__time">
            <div class="div__time">
                <p>You are online for: 1h 30m</p>
                <p>Your local time is: 10:45</p>
            </div>
            <div class="div__edit">
                <a href="#"><strong>Edit personal info</strong></a>
                <a href="#"><strong>Private messages</strong></a>
            </div>
            <div class="div__btn">
                <a href="index.html" class="btn__header" style="margin-bottom: 10%;">Login</a>
                <a href="registration.html" class="btn__header">Registration</a>
            </div>
        </div>
        </div>
    </header>
    <div class="div__main">
        <div id="div__users__chat__online">
            <div id="div__users__chat">
            </div>
        </div>
        <div class="div__chat">
            <div class="div__tabs">
                <p class="p__tabs" style="background: rgba(33, 165, 28, 0.2);">Main chat</p>
                <p class="p__tabs" style="background: rgba(50, 50, 50, 0.6);">Chat with Alison</p>
            </div>
            <div class="div__chat_m">
                <p class="nick__name"><strong>John Snow:</strong></p>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Perspiciatis fugiat saepe nobis. Eos,
                    dolor distinctio iusto odio quod mollitia vitae tenetur consequuntur at error illum in velit quo
                    corporis blanditiis.</p><br>
                <p class="nick__name"><strong>Alison Black:</strong></p>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Dicta quasi labore vero sapiente,
                    reprehenderit sit consequatur magnam veritatis unde consectetur. Deserunt voluptas debitis iure
                    vel quam provident enim quae commodi?</p><br>
                <p class="nick__name"><strong>John Snow:</strong></p>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Illum adipisci quam placeat consequatur
                    necessitatibus culpa harum alias corporis dolorem tempore numquam odit, atque dolore sint vitae
                    optio, temporibus qui a!</p><br>
            </div>
            <input class="div__enter__message" type="text" placeholder="Write a message...">
            <div class="buttons">
                <button class="button__message">B</button>
                <button class="button__message">I</button>
                <button class="button__message">U</button>
                <button class="button__message" style="margin-left: 2%;">Link</button>
                <button class="button__message"
                    style="float: right; margin-top: 1%;width: 15%; text-transform: uppercase;">Send message</button>
            </div>
        </div>
    </div>
    <footer class="footer">
        <h4>Widget for displaying information about the entered
            message</h4>
        <div class="div__f__p">
            <p>31 characters entered;</p>
            <p>25 letters endered;</p>
            <p>4 whitespace characters entered;</p>
            <p>2 punctuation marks entered.</p>
            <p><strong>Have a nice day ;D</strong></p>
    </footer>
    <script>
        function usersInChat(method, url) {
            let xhr = new XMLHttpRequest();

            xhr.open(method, url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.responseType = 'json';

            xhr.onload = () => {
                if (xhr.status >= 400) {
                    alert("status>400")
                } else {
                    let countOnline = 0, allUsers = 0;
                    for (let i = 0; i < xhr.response.length; i++) {
                        if (xhr.response[i].status == "active") {
                            let divRed = document.createElement('div');
                            divRed.innerHTML = '.';
                            divRed.style.width = '10%';
                            // divRed.style.height = '5%';
                            divRed.style.border = '1px solid green';
                            divRed.style.borderRadius = '50%';
                            divRed.style.background = 'green';
                            divRed.style.color = 'green';
                            divRed.style.display = 'inline-block';
                            div__users__chat.append(divRed);
                            countOnline++;
                        } else {
                            let divRed = document.createElement('div');
                            divRed.innerHTML = '.';
                            divRed.style.width = '10%';
                            // divRed.style.height = '5%';
                            divRed.style.border = '1px solid red';
                            divRed.style.borderRadius = '50%';
                            divRed.style.background = 'red';
                            divRed.style.color = 'red';
                            divRed.style.display = 'inline-block';
                            div__users__chat.append(divRed);
                        }
                        let pLast = document.createElement('p');
                        pLast.innerHTML = xhr.response[i].username;
                        pLast.style.display = 'inline-block';
                        pLast.style.marginLeft = '10%';
                        pLast.style.fontSize = '18px';
                        pLast.style.fontFamily = 'Uchen';
                        div__users__chat.append(pLast);

                        let tempBlock = document.createElement('div');
                        tempBlock.innerHTML = '';
                        tempBlock.style.marginBottom = '2%';
                        div__users__chat.append(tempBlock);
                        allUsers++;
                    }
                    let pOnline = document.createElement('p');
                    pOnline.style.display = 'flex';
                    pOnline.style.justifyContent = 'space-around';
                    pOnline.style.fontSize = '20px';
                    pOnline.innerHTML = 'Online: ' + countOnline;
                    div__users__chat__online.prepend(pOnline);

                    let pAllUsers = document.createElement('p');
                    pAllUsers.style.display = 'flex';
                    pAllUsers.style.justifyContent = 'space-around';
                    pAllUsers.style.fontSize = '26px';
                    pAllUsers.innerHTML = 'All users: ' + allUsers;
                    div__users__chat__online.prepend(pAllUsers);
                }
            }
            xhr.onerror = () => alert("Error!");

            xhr.send();
        }
        usersInChat("GET", "https://studentschat.herokuapp.com/users");
    </script>
</body>

</html>